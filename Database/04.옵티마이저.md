# 옵티마이저

- SQL 실행계획을 수립하고 SQL을 실행하는 데이터베이스 관리 시스템의 소프트웨어
- 특징
  - 데이터 딕셔너리에 있는 오프젝트 통계, 시스템 통계 등의 정보를 이용해 비용을 산정
  - 산정 후 최저비용을 가지고 있는 계획을 선택해서 SQL 실행
- 실행계획 확인 : 실행 계획을 Plan_table에 저장하고 개발자는 확인할 수 있다.

### 옵티마이저 종류

- 실행방법
  - 개발자가 SQL 실행 후 파싱을 실행해 문법 검사, 구분 분석 수행
  - 옵티마이저가 규치 기반, 비용기반으로 계획수립
  - 수립 완료 후 최종적으로 SQL을 실행하고 실행이 완료되면 인출(Fetch)함
- 엔진
  - query transformer
  - estimator
  - plan generator

#### 01. 규칙기반 옵티마이저 
- 15개 우선 순위를 기준으로 실행계획을 수립

#### 02. 비용기반 옵티마이저 

- 오브젝트 통계 및 시스템 통계를 사용해서 총 비용을 계산
- 쿼리를 수행하는데 소용되는 일량 또는 시간을 기반으로 최적화를 수행



### 인덱스

- 데이터를 빠르게 검색할 수 있는 방법을 제공

- 인덱스 키에 정렬되어 있어 원하는 데이터를 빠르게 조회

- 오름차순, 내림차순 탐색 가능하면 하나의 테이블에 여러 개의 인덱스 사용하고 하나의 인덱스는 여러 개의 칼럼으로 구성될 수 있다.

#### 01. 인덱스 구조

  - root block : 인덱스 트리에서 가장 상위에 있는 노드
  - branch block : 다음 단계의 주소를 갖는 포인터로 되어 있음
  - leaf block : 인덱스 키와 rowid로 구서오디고 인덱스 키는 정렬되어서 저장

- 인덱스 생성 : create index 문 사용

#### 02. 인덱스 스캔 

  - 인덱스 유일 스캔 : 인덱스의 키 값이 중봅기 아닐 떼, 해당 인덱스 사용시 발생

  - 인덱스 범위 스캔 : select문에서 특정 범위를 조회하는 where문 사용할 경우 발생
  - 인덱스 전체 스캔 : 인덱스에서 검색되는 인덱스 키가 많은 경우에 leaf block의 처음부터 끝까지 읽음

- 실행 계획 : SQL문을 읽는 방법으로 나온 순서대로 읽으면 됨



### 옵티마이저 조인

#### 01. Nested Loop join (NP join)

- 하나의 테이블에서 데이터를 먼저 찾고 테이블을 조인하는 방식
- 먼저 조회되는 테이블을 외부 테이블이고 다음에는 내부 테이블 조회함
- random access가 발생하는데 random access가 많이 발생 시 성능 지연 발생

#### 02. Sort Merge join

- 두 개의 테이블을 sort_area라는 메모리 공간에 모두 로딩하고 sort를 수행
- 두 개의 테이블에 대해서 sort 완료 시 두개의 테이블을 병합
- 정렬이 발생하기 때문에 데이터 양이 많아지면 성능이 떨어지게 됨
- 정렬 데이터가 너무 많으면 임시 영역에서 수행

#### 03. Hash Merge join

- 두 개의 테이블에서 작은 테이블을 hash 메모리에 로딩하고 두 개의 테이블의 조인 키를 사용해서 해시 테이블 생성
- 해시 함수 사용해서 주소를 계산하고 해다 주소를 사용해서 테이블을 조회하기 때문에 CPU 연산을 많이함
- Hash 조인 시 선행 테이블이 충분히 메모리에 로디오디는 크기여야함

